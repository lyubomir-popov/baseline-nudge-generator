<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Baseline Demo</title>
    
    <!-- Load Inter font from Google Fonts -->
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");
        
        :root {
            --baseline-unit: 0.5rem;
            --font-family: 'Inter', system-ui, sans-serif;
        }
        
        /* Baseline grid background */
        .baseline-grid {
            background-image: linear-gradient(
                to bottom,
                rgba(255, 0, 0, 0.3) 0px,
                rgba(255, 0, 0, 0.3) 1px,
                transparent 1px,
                transparent var(--baseline-unit)
            );
            background-size: 100% var(--baseline-unit);
            background-position: 0 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            line-height: 1.5;
            color: #333;
            min-height: 100vh;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Typography elements will be styled via JavaScript */
    </style>
</head>
<body>
    <h1>Heading 1</h1>
    <h2>Heading 2</h2>
    <h3>Heading 3</h3>
    <h4>Heading 4</h4>
    <h5>Heading 5</h5>
    <h6>Heading 6</h6>
    <p>This is a paragraph with baseline grid alignment.</p>

    <script>
        // Font metrics from Inter font file (actual values)
        const FONT_METRICS = {
            ascent: 1984,
            descent: -494,
            lineGap: 0,
            unitsPerEm: 2048,
            capHeight: 1490,
            xHeight: 1118
        };

        // Configuration
        const config = {
            baselineUnit: 0.5,
            elements: [
                { classname: "h1", fontSize: 4, lineHeight: 9 },
                { classname: "h2", fontSize: 3.5, lineHeight: 8 },
                { classname: "h3", fontSize: 3, lineHeight: 7 },
                { classname: "h4", fontSize: 2.5, lineHeight: 6 },
                { classname: "h5", fontSize: 2, lineHeight: 5 },
                { classname: "h6", fontSize: 1.5, lineHeight: 4 },
                { classname: "p", fontSize: 1, lineHeight: 3 }
            ]
        };

        // Calculate nudge value (our current logic)
        function calculateNudge(fontSize, lineHeight, baselineUnit, metrics) {
            const fontSizeInPixels = fontSize * 16; // 1rem = 16px
            const lineHeightInPixels = lineHeight * baselineUnit * 16;
            
            // Calculate baseline offset
            const ascentRatio = metrics.ascent / metrics.unitsPerEm;
            const descentRatio = Math.abs(metrics.descent) / metrics.unitsPerEm;
            
            const leadingTop = (lineHeightInPixels - fontSizeInPixels) / 2;
            const baselineFromTop = leadingTop + (fontSizeInPixels * ascentRatio);
            
            const baselineUnitInPixels = baselineUnit * 16;
            const gridPosition = Math.ceil(baselineFromTop / baselineUnitInPixels) * baselineUnitInPixels;
            const nudge = gridPosition - baselineFromTop;
            
            return nudge / 16; // Convert back to rem
        }

        // Calculate nudge using the working logic from generate-nudges.cjs
        function calculateNudgeRem(fontSizeRem, lineHeightRem, baselineUnitRem) {
            // Convert font metrics to rem units (correct scaling)
            const ascenderRem = FONT_METRICS.ascent * fontSizeRem / FONT_METRICS.unitsPerEm;
            const descenderRem = Math.abs(FONT_METRICS.descent) * fontSizeRem / FONT_METRICS.unitsPerEm;
            const lineGapRem = FONT_METRICS.lineGap * fontSizeRem / FONT_METRICS.unitsPerEm;
            
            // Content area includes lineGap (using Alt1: add lineGap to ascent only)
            const effectiveAscenderRem = ascenderRem + lineGapRem;
            const effectiveDescenderRem = descenderRem;
            const contentAreaRem = effectiveAscenderRem + effectiveDescenderRem;
            
            // Line height in rem (convert from baseline units)
            const lineHeightAbsoluteRem = lineHeightRem * baselineUnitRem;
            
            // Leading (extra space beyond content area)
            const leadingRem = lineHeightAbsoluteRem - contentAreaRem;
            
            // Baseline position from top of line box (using effective ascender)
            const baselineOffsetRem = leadingRem / 2 + effectiveAscenderRem;
            
            // Grid size (baseline unit)
            const gridSizeRem = baselineUnitRem;
            
            // Calculate nudge to align baseline with grid
            const nudgeRem = (Math.ceil(baselineOffsetRem / gridSizeRem) * gridSizeRem) - baselineOffsetRem;
            
            return Math.round(nudgeRem * 1000) / 1000;
        }

        // Apply styles to elements
        function applyStyles() {
            config.elements.forEach(element => {
                const fontSize = element.fontSize;
                const lineHeight = element.lineHeight * config.baselineUnit;
                const spaceAfter = 2 * config.baselineUnit; // 1rem default spacing
                
                // Calculate nudge using both methods for comparison
                const nudgeOurMethod = calculateNudge(fontSize, element.lineHeight, config.baselineUnit, FONT_METRICS);
                const nudgeWorkingMethod = calculateNudgeRem(fontSize, element.lineHeight, config.baselineUnit);
                
                console.log(`${element.classname}:`);
                console.log(`  Our method nudge: ${nudgeOurMethod.toFixed(3)}rem`);
                console.log(`  Working method nudge: ${nudgeWorkingMethod.toFixed(3)}rem`);
                console.log(`  Difference: ${Math.abs(nudgeOurMethod - nudgeWorkingMethod).toFixed(3)}rem`);
                
                // Use the working method with correct values from tokens.json
                const nudge = Math.max(0, nudgeWorkingMethod);
                const paddingTop = nudge;
                const marginBottom = spaceAfter - nudge;
                
                console.log(`  Applied: padding-top: ${paddingTop.toFixed(3)}rem, margin-bottom: ${marginBottom.toFixed(3)}rem`);
                
                const domElement = document.querySelector(element.classname);
                domElement.style.fontSize = `${fontSize}rem`;
                domElement.style.lineHeight = `${lineHeight}rem`;
                domElement.style.paddingTop = `${paddingTop}rem`;
                domElement.style.marginBottom = `${marginBottom}rem`;
                domElement.style.fontFamily = 'var(--font-family)';
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Enable grid
            document.body.classList.add('baseline-grid');
            
            // Apply styles
            applyStyles();
            
            console.log('Font loaded:', document.fonts.check('1em Inter'));
        });
    </script>
</body>
</html> 